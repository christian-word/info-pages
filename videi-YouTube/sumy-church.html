<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Архів Відео | Дім Євангелія</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.6);
            --accent-green: #22c55e;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
            color: var(--text-main);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }
        .header-site { text-align: center; margin-bottom: 20px; }
        .header-site h1 { font-size: 2rem; margin: 0; background: linear-gradient(to right, #f8fafc, #22c55e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .header-site p { color: var(--text-dim); font-size: 0.9rem; margin: 5px 0 0; }

        .controls-section { width: 100%; max-width: 1000px; background: var(--card-bg); backdrop-filter: blur(15px); padding: 25px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 50px rgba(0,0,0,0.4); }
        
        .search-wrapper { display: flex; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; padding: 14px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); background: rgba(15, 23, 42, 0.7); color: white; font-size: 1rem; outline: none; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--accent-green); }
        
        .btn-clear-all { background: #ef4444; color: white; border: none; padding: 0 20px; border-radius: 50px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: 0.3s; }

        .main-actions { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .expandable-panel { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); }

        .date-filter-box { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; align-items: center; padding: 10px; }
        .date-input-group { display: flex; align-items: center; gap: 8px; color: var(--text-dim); font-size: 0.9rem; }
        input[type="date"] { background: #1e293b; border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px; border-radius: 12px; color-scheme: dark; }
        
        .filter-label { display: block; margin-bottom: 12px; text-align: center; font-size: 0.7rem; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }
        .quick-tags { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        
        .tag-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: var(--text-main); padding: 8px 16px; border-radius: 50px; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .tag-btn:hover { background: rgba(34, 197, 94, 0.2); border-color: var(--accent-green); }
        
        .toggle-btn { background: rgba(148, 163, 184, 0.1); border: 1px solid rgba(255,255,255,0.2); color: var(--text-main); font-size: 0.85rem; padding: 10px 20px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .toggle-btn.active { border-color: var(--accent-green); color: var(--accent-green); }

        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; width: 100%; max-width: 1200px; margin-top: 30px; }
        .video-card { background: var(--card-bg); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; cursor: pointer; }
        .video-card:hover { transform: translateY(-5px); border-color: var(--accent-green); }
        .thumbnail { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .info { padding: 15px; }
        .video-title { font-weight: 600; font-size: 0.85rem; margin-bottom: 8px; height: 2.8em; overflow: hidden; line-height: 1.4; }
        .video-meta { display: flex; justify-content: space-between; color: var(--text-dim); font-size: 0.7rem; }
        
        #stats { margin-top: 20px; color: var(--accent-green); font-weight: 700; text-align: center; }

        /* Стилі для відео-плеєра (Modal) */
        .video-modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px); justify-content: center; align-items: center;
        }
        .modal-content { width: 90%; max-width: 900px; position: relative; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px; box-shadow: 0 0 50px rgba(34, 197, 94, 0.2); }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .close-modal { position: absolute; top: -45px; right: 0; color: white; font-size: 30px; cursor: pointer; transition: 0.3s; }
        .close-modal:hover { color: var(--accent-green); }
    </style>
</head>
<body>

<div class="header-site">
    <h1>АРХІВ ВІДЕО</h1>
    <p>Церква "Дім Євангелія", м. Суми</p>
</div>

<div class="controls-section">
    <div class="search-wrapper">
        <input type="text" id="searchInput" placeholder="Пошук (прізвище, тема)...">
        <button class="btn-clear-all" id="btnAllClear">Скинути</button>
    </div>

    <div class="filter-group">
        <span class="filter-label">Проповідники</span>
        <div class="quick-tags" id="preachersContainer"></div>
    </div>

    <div class="main-actions" style="margin-top: 20px;">
        <button class="toggle-btn" id="btnShowCategories"><i class="fas fa-list"></i> Більше категорій</button>
        <button class="toggle-btn" id="btnShowDate"><i class="fas fa-calendar-alt"></i> По даті</button>
    </div>

    <div id="panelCategories" class="expandable-panel">
        <span class="filter-label">Категорії служінь</span>
        <div class="quick-tags" id="servicesContainer"></div>
    </div>

    <div id="panelDate" class="expandable-panel">
        <span class="filter-label">Виберіть період</span>
        <div class="date-filter-box">
            <div class="date-input-group"><span>Від:</span> <input type="date" id="dateStart"></div>
            <div class="date-input-group"><span>До:</span> <input type="date" id="dateEnd"></div>
        </div>
    </div>

    <div id="stats">Завантаження...</div>
</div>

<div class="video-grid" id="videoGrid"></div>

<div id="videoModal" class="video-modal">
    <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <div class="video-container">
            <iframe id="youtubePlayer" src="" allowfullscreen></iframe>
        </div>
    </div>
</div>

<script>
    const FILE_URL = 'https://raw.githubusercontent.com/ruyriy/Audio-christ/refs/heads/main/filtered_video/filtered_video.txt';
    
    function parseUkrainianDate(str) {
        if (!str) return null;
        const months = {"січня":0,"лютого":1,"березня":2,"квітня":3,"травня":4,"червня":5,"липня":6,"серпня":7,"вересня":8,"жовтня":9,"листопада":10,"грудня":11};
        const parts = str.split(' ');
        if (parts.length < 3) return null;
        return new Date(parseInt(parts[2]), months[parts[1].toLowerCase()], parseInt(parts[0]));
    }

    const preachers = [
        { key: 'Марйоха', label: 'Марйоха М.' }, { key: 'Міщенко', label: 'Міщенко А.' },
        { key: 'Булигін', label: 'Булигін А.' }, { key: 'Зінченко', label: 'Зінченко В.' },
        { key: 'Лаба', label: 'Лаба В.' }, { key: 'Парфило', label: 'Парфило А.' },
        { key: 'Комисар', label: 'Комисар С.' }, { key: 'Іванченко', label: 'Іванченко О.' },
        { key: 'Савченко', label: 'Савченко О.' }
    ];

    const services = [
        { key: 'Богослуж', label: 'Богослужіння' }, { key: 'Вірш', label: 'Вірші' },
        { key: 'Хор', label: 'Хори' }, { key: 'Служіння', label: 'Служіння' },
        { key: 'Прославлення', label: 'Прославлення' }, { key: 'Хрещення', label: 'Хрещення' },
        { key: '', label: 'Всі відео' }
    ];

    let allVideos = [];

    function normalize(t) { return t ? t.toLowerCase().replace(/[ііїi]/g, 'i').replace(/[иы]/g, 'и').replace(/[^a-zа-я0-9]/gi, '') : ''; }

    async function loadData() {
        try {
            const r = await fetch(FILE_URL + '?t=' + new Date().getTime());
            const t = await r.text();
            allVideos = t.split('\n').filter(l => l.includes('§')).map(line => {
                const p = line.split('§');
                return { year: p[1], id: p[2], title: p[3], dateStr: p[4], techDate: parseUkrainianDate(p[4]) };
            });
            render();
        } catch (e) { document.getElementById('stats').textContent = "Помилка!"; }
    }

    function openVideo(id) {
        const modal = document.getElementById('videoModal');
        const player = document.getElementById('youtubePlayer');
        player.src = `https://www.youtube.com/embed/${id}?autoplay=1`;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Заборонити прокрутку сторінки
    }

    function closeVideo() {
        const modal = document.getElementById('videoModal');
        const player = document.getElementById('youtubePlayer');
        player.src = ''; // Зупинити відео
        modal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Повернути прокрутку
    }

    function render() {
        const query = normalize(document.getElementById('searchInput').value);
        const startVal = document.getElementById('dateStart').value;
        const endVal = document.getElementById('dateEnd').value;

        const filtered = allVideos.filter(v => {
            const matchText = normalize(v.title).includes(query);
            let vDate = v.techDate;
            const dateMatch = v.title.match(/(\d{1,2})\.(\d{1,2})\.(\d{4})/);
            if (dateMatch) vDate = new Date(parseInt(dateMatch[3]), parseInt(dateMatch[2]) - 1, parseInt(dateMatch[1]));

            if (!vDate) return matchText;
            const cTime = new Date(vDate.getFullYear(), vDate.getMonth(), vDate.getDate()).getTime();
            let mDate = true;
            if (startVal) {
                const s = new Date(startVal);
                if (cTime < new Date(s.getFullYear(), s.getMonth(), s.getDate()).getTime()) mDate = false;
            }
            if (endVal) {
                const e = new Date(endVal);
                if (cTime > new Date(e.getFullYear(), e.getMonth(), e.getDate()).getTime()) mDate = false;
            }
            return matchText && mDate;
        });

        const grid = document.getElementById('videoGrid');
        grid.innerHTML = '';
        filtered.forEach(v => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.onclick = () => openVideo(v.id);
            card.innerHTML = `<img class="thumbnail" src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg" loading="lazy">
                <div class="info"><div class="video-title">${v.title}</div>
                <div class="video-meta"><span>${v.dateStr}</span><span>${v.year} р.</span></div></div>`;
            grid.appendChild(card);
        });
        document.getElementById('stats').innerHTML = `<i class="fas fa-database"></i> Знайдено: ${filtered.length}`;
    }

    function setup() {
        const pc = document.getElementById('preachersContainer');
        preachers.forEach(p => {
            const b = document.createElement('button'); b.className = 'tag-btn'; b.textContent = p.label;
            b.onclick = () => { document.getElementById('searchInput').value = p.key; render(); };
            pc.appendChild(b);
        });

        const sc = document.getElementById('servicesContainer');
        services.forEach(s => {
            const b = document.createElement('button'); b.className = 'tag-btn'; b.textContent = s.label;
            b.onclick = () => { document.getElementById('searchInput').value = s.key; render(); };
            sc.appendChild(b);
        });

        document.getElementById('btnShowCategories').onclick = () => { 
            const p = document.getElementById('panelCategories'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; 
        };
        document.getElementById('btnShowDate').onclick = () => { 
            const p = document.getElementById('panelDate'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; 
        };

        document.getElementById('btnAllClear').onclick = () => {
            document.getElementById('searchInput').value = '';
            document.getElementById('dateStart').value = '';
            document.getElementById('dateEnd').value = '';
            render();
        };

        document.getElementById('closeModal').onclick = closeVideo;
        window.onclick = (e) => { if (e.target.id === 'videoModal') closeVideo(); };

        document.getElementById('searchInput').addEventListener('input', render);
        document.getElementById('dateStart').addEventListener('change', render);
        document.getElementById('dateEnd').addEventListener('change', render);

        loadData();
    }
    setup();
</script>
</body>
</html>